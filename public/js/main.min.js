jQuery(document).ready(function(){jQuery(".raised-form").submit(function(k){k.preventDefault();window.location.href="/activities/"+jQuery("#activity_id_r").val()+"?dt="+jQuery("#activity_date_r").val();return false});jQuery(".btn-map").click(function(){jQuery("#map-modal").data("lat",jQuery(this).data("lat"));jQuery("#map-modal").data("lng",jQuery(this).data("lng"));jQuery("#map-modal").data("title",jQuery(this).data("title"));jQuery("#map-modal").modal("show")});jQuery("#map-modal").on("shown.bs.modal",function(){var p=jQuery(this).data("lat"),m=jQuery(this).data("lng");var q=jQuery(this).data("title");var n=new google.maps.LatLng(p,m);var l={zoom:15,center:n,mapTypeId:google.maps.MapTypeId.ROADMAP};var o=new google.maps.Map(document.getElementById("map-container"),l);var k=new google.maps.Marker({position:n,map:o,title:q})});function g(){$.ajax({type:"GET",url:"/activities/getsuprogram",data:"",success:function(k){$("#count_activities").text(k.data.offers);$("#count_persons").text(k.data.persons)},error:function(){location.reload()}})}$(".overlay-opener").click(function(k){k.preventDefault()});jQuery(".btn-reserve").click(function(){var m=$("#reserve-date").val();if(m==""){$("#message-modal #message").text("Seleccione primero la fecha.");$("#message-modal").modal("show");return false}var n=jQuery(this).data("offer-id");var l=$(this).parents(".offer-item").find(".persona").val();if(l==""){$("#message-modal #message").text("Seleccione primero la cantidad de personas de esta actividad.");$("#message-modal").modal("show");return false}var k=$(this).parents(".offer-item").find("select.hours").val();if(k==""){$("#message-modal #message").text("Seleccione primero la cantidad de horario de esta actividad.");$("#message-modal").modal("show");return false}$.ajax({type:"POST",url:"/offer/reserve",data:{_token:$('meta[name="csrf-token"]').attr("content"),offer_id:n,persons:l,date:m,timeRange:k},error:function(){location.reload()}}).done(function(){g();$.ajax({type:"GET",url:"/activities/getselectedoffers",data:"",success:function(p){var o=p.data[p.data.length-1];if($(".offers-list li").length===0){$("section.widget.summary").slideDown()}var q=moment(o.date,"DD/MM/YYYY").format("DD/MM");$(".offers-list").append("<li><a href='#'>"+q+" - "+o.name+"</a>");$("html, body").animate({scrollTop:"0px"},800)},error:function(){location.reload()}})});return false});jQuery(".btn-reserve-ag").click(function(){var m=jQuery(this).parents(".offer-item").find(".reserve-date").val();if(m==""){$("#message-modal #message").text("Please choose the date first.");$("#message-modal").modal("show");return false}var n=jQuery(this).data("offer-id");var l=$(this).parents(".offer-item").find(".persona").val();if(l==""){$("#message-modal #message").text("Choose persona first.");$("#message-modal").modal("show");return false}var k=$(this).parents(".offer-item").find("select.hours").val();if(k==""){$("#message-modal #message").text("Choose time.");$("#message-modal").modal("show");return false}$.ajax({type:"POST",url:"/offer/reserve",data:{_token:$('meta[name="csrf-token"]').attr("content"),offer_id:n,persons:l,date:m,timeRange:k},error:function(){location.reload()}});return false});function d(){var l=0;var k;$(".offers-list li").each(function(){var m=($(this).find("span").text());l+=parseInt(m.split(".").join(""))});$(".total .totalprice p").text(Number(l).toLocaleString("de-DE"));k=parseInt(l*0.1);$(".total .discount p").text(Number(k).toLocaleString("de-DE"))}jQuery(".offers-list").on("click","a",function(){var l=$(this).parent().prevAll().length;var k=$(this).parent();$.ajax({type:"POST",url:"/offer/remove",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:l},success:function(){k.remove();g();if($(".offers-list li").length===0){$("section.widget.summary").slideUp()}if(window.location.pathname==="/calendar"){d();jQuery("#calendar").fullCalendar("refetchEvents")}if(window.location.pathname==="/reserve"){location.reload()}},error:function(){location.reload()}});return false});var e;$(".delete_offer a").click(function(k){e=$(this).attr("href");k.preventDefault();$("#myModal").modal()});$("#confirm_cancel").click(function(k){k.preventDefault();window.location.href=e});if($("#calendar").length){var f=$("#calendar").attr("data-date");var c=$("#calendar").attr("data-lang");if(c==="es_ES"){c="es"}jQuery("#calendar").fullCalendar({lang:c,header:{left:"prev,next today",center:"title",right:""},defaultView:"agendaFourDay",views:{agendaFourDay:{type:"agenda",duration:{days:5},buttonText:"5 days",columnFormat:"ddd D/M"}},allDaySlot:false,defaultDate:f,editable:false,eventLimit:true,events:"/calendar/data",eventOverlap:true,eventRender:function(l,k){k.data("duplicate",l.duplicate);k.append("<br>");k.append('<a href="#" class="move prev" data-oid="'+l.id+'"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></a>');k.append('<a href="#" class="move next" data-oid="'+l.id+'"><span class="glyphicon glyphicon-chevron-right pull-right" aria-hidden="true"></span></a>');k.append("<br>");if(l.agency_name!=undefined){k.append('<div class="agency-name">'+l.agency_name+"</div>")}else{k.append("<br>")}k.append('<div class="hours"><i class="glyphicon glyphicon-time"></i> '+l.hours+" hrs ("+l.start_time+" a "+l.end_time+")</div>");if(l.persons!=undefined){k.append('<div class="persona"><i class="glyphicon glyphicon-user"></i> '+l.persons+" persona</div>")}k.append("<br>");k.append('<a href="#" class="delete" data-oid="'+l.id+'"><span class="glyphicon glyphicon-remove pull-right" aria-hidden="true"></span></a>')},eventAfterAllRender:function(k){jQuery(".btn-reservar").attr("href","/reserve");jQuery(".alert-overlap").hide();$.each($(".fc-event"),function(l,m){if($(m).data("duplicate")){$(".alert-overlap").show();$(".btn-reservar").removeAttr("href")}})}})}jQuery(document).on("click",".fc-event.cal-offer .move",function(m){m.preventDefault();var l=jQuery(this).data("oid");var k=jQuery(this).hasClass("prev")?"prev":jQuery(this).hasClass("next")?"next":"";$.ajax({type:"POST",url:"/calendar/process",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:l,dir:k},success:function(n){jQuery("#calendar").fullCalendar("refetchEvents")}})});jQuery(document).on("click",".fc-event.cal-offer .delete",function(l){l.preventDefault();var k=jQuery(this).data("oid");$("#delete-modal .btn-confirm").data("oid",k);$("#delete-modal").modal("show")});jQuery("#delete-modal .btn-confirm").on("click",function(l){l.preventDefault();var k=jQuery(this).data("oid");$("#delete-modal").modal("hide");$.ajax({type:"POST",url:"/offer/remove",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:k},success:function(){jQuery("#calendar").fullCalendar("refetchEvents");g();$(".offers-list li").each(function(m){if(m===k){$(this).remove()}});d()}})});function j(k){var l=$("#calendar").fullCalendar("clientEvents");for(i in l){if(l[i].id!=k.id){if(!(Date(l[i].start)>=Date(k.end)||Date(l[i].end)<=Date(k.start))){return true}}}return false}var b=$(".contact-form textarea[name='message']");var a=false;b.on("input",function(){if(b.val().length>2&&!a){$(".captcha-row").slideDown();a=true}});function h(k){return k.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}jQuery(".persona").on("change",function(){var m=$(this).parents(".offer-item").find(".price");var k=$(this).parents(".offer-item").find(".price sub").html();var l=0+m.data("unit-price");m.html("<del> <small><sub>"+k+"</sub>"+h($(this).val()*l)+"</small></del><br><sub>"+k+"</sub>"+h(Math.round($(this).val()*l*0.9)))});$("#image").change(function(){this.form.submit();$("#hiddenframe").on("load",function(){$.ajax({type:"GET",url:"/user/getAvatar",data:"",success:function(k){$("#youravatar").attr("src",k)}})})})});$(window).load(function(){if(window.location.pathname.indexOf("/guia/")===0){$(".opiniones").css("visibility","visible");$("#CDSWIDSSP .widSSPData .widSSPTrvlRtng .widSSPOverall div").each(function(){var a=$(this).html();$(this).html(a.replace("de viajeros",""))})}if(window.location.pathname.indexOf("/activity/")===0){$("#CDSWIDSSP .widSSPData .widSSPBranding dt a img, #CDSWIDSSP .widSSPData .widSSPBranding dt a:link img").attr("src","/images/logo-trip.png")}});