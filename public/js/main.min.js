jQuery(document).ready(function(){jQuery(".raised-form").submit(function(m){m.preventDefault();window.location.href="/activities/"+jQuery("#activity_id_r").val()+"?dt="+jQuery("#activity_date_r").val();return false});jQuery(".btn-map").click(function(){jQuery("#map-modal").data("lat",jQuery(this).data("lat"));jQuery("#map-modal").data("lng",jQuery(this).data("lng"));jQuery("#map-modal").data("title",jQuery(this).data("title"));jQuery("#map-modal").modal("show")});jQuery("#map-modal").on("shown.bs.modal",function(){var r=jQuery(this).data("lat"),o=jQuery(this).data("lng");var s=jQuery(this).data("title");var p=new google.maps.LatLng(r,o);var n={zoom:15,center:p,mapTypeId:google.maps.MapTypeId.ROADMAP};var q=new google.maps.Map(document.getElementById("map-container"),n);var m=new google.maps.Marker({position:p,map:q,title:s})});function h(){$.ajax({type:"GET",url:"/activities/getsuprogram",data:"",success:function(m){$("#program_activities").text(m.data.offers);$("#program_persons").text(m.data.persons);$("#program_total").text(m.data.total)},error:function(){location.reload()}})}$(".overlay-opener").click(function(m){m.preventDefault()});$(".btn-reserve").click(function(){var o=$("#reserve-date").val();if(o==""){$("#message-modal #message").text("Seleccione primero la fecha.");$("#message-modal").modal("show");return false}var p=jQuery(this).data("offer-id");var n=$(this).parents(".offer-item").find(".persona").val();if(n==""){$("#message-modal #message").text("Seleccione primero la cantidad de personas de esta actividad.");$("#message-modal").modal("show");return false}var m=$(this).parents(".offer-item").find("select.hours").val();if(m==""){$("#message-modal #message").text("Seleccione primero la cantidad de horario de esta actividad.");$("#message-modal").modal("show");return false}$.ajax({type:"POST",url:"/offer/reserve",data:{_token:$('meta[name="csrf-token"]').attr("content"),offer_id:p,persons:n,date:o,timeRange:m},error:function(){location.reload()}}).done(function(){h();$.ajax({type:"GET",url:"/activities/getselectedoffers",data:"",success:function(r){var q=r.data[r.data.length-1];if($(".offers-list li").length===0){$("section.widget.summary").slideDown()}var s=moment(q.date,"DD/MM/YYYY").format("DD/MM");$(".offers-list").append("<li><a href='#'>"+s+" - "+q.name+"</a>");$("html, body").animate({scrollTop:"0px"},800)},error:function(){location.reload()}})});return false});jQuery(".btn-reserve-ag").click(function(){var o=jQuery(this).parents(".offer-item").find(".reserve-date").val();if(o==""){$("#message-modal #message").text("Please choose the date first.");$("#message-modal").modal("show");return false}var p=jQuery(this).data("offer-id");var n=$(this).parents(".offer-item").find(".persona").val();if(n==""){$("#message-modal #message").text("Choose persona first.");$("#message-modal").modal("show");return false}var m=$(this).parents(".offer-item").find("select.hours").val();if(m==""){$("#message-modal #message").text("Choose time.");$("#message-modal").modal("show");return false}$.ajax({type:"POST",url:"/offer/reserve",data:{_token:$('meta[name="csrf-token"]').attr("content"),offer_id:p,persons:n,date:o,timeRange:m},error:function(){location.reload()}});return false});function e(){var n=0;var m;$(".offers-list li").each(function(){var o=($(this).find("span").text());n+=parseInt(o.split(".").join(""))});$(".total .totalprice p").text(Number(n).toLocaleString("de-DE"));m=parseInt(n*0.1);$(".total .discount p").text(Number(m).toLocaleString("de-DE"))}jQuery(".offers-list").on("click","a",function(){var n=$(this).parent().prevAll().length;var m=$(this).parent();$.ajax({type:"POST",url:"/offer/remove",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:n},success:function(){m.remove();h();if($(".offers-list li").length===0){$("section.widget.summary").slideUp()}if(window.location.pathname==="/calendar"){e();jQuery("#calendar").fullCalendar("refetchEvents")}if(window.location.pathname==="/reserve"){location.reload()}},error:function(){location.reload()}});return false});var f;$(".delete_offer a").click(function(m){f=$(this).attr("href");m.preventDefault();$("#myModal").modal()});$("#confirm_cancel").click(function(m){m.preventDefault();window.location.href=f});if($("#calendar").length){var g=$("#calendar").attr("data-date");var c=$("#calendar").attr("data-lang");var l,d=$(window).width();if(d>=992){l=5}else{if(d<991&&d>600){l=3}else{l=2}}if(c==="es_ES"){c="es"}jQuery("#calendar").fullCalendar({lang:c,header:{left:"prev,next today",center:"title",right:""},defaultView:"agendaFourDay",views:{agendaFourDay:{type:"agenda",duration:{days:l},buttonText:"5 days",columnFormat:"ddd D/M"}},allDaySlot:false,defaultDate:g,editable:false,eventLimit:true,events:"/calendar/data",eventOverlap:true,eventRender:function(n,m){m.data("duplicate",n.duplicate);m.append("<br>");m.append('<a href="#" class="move prev" data-oid="'+n.id+'"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></a>');m.append('<a href="#" class="move next" data-oid="'+n.id+'"><span class="glyphicon glyphicon-chevron-right pull-right" aria-hidden="true"></span></a>');m.append("<br>");if(n.agency_name!=undefined){m.append('<div class="agency-name">'+n.agency_name+"</div>")}else{m.append("<br>")}m.append('<div class="hours"><i class="glyphicon glyphicon-time"></i> '+n.hours+" hrs ("+n.start_time+" a "+n.end_time+")</div>");if(n.persons!=undefined){m.append('<div class="persona"><i class="glyphicon glyphicon-user"></i> '+n.persons+" persona</div>")}m.append("<br>");m.append('<a href="#" class="delete" data-oid="'+n.id+'"><span class="glyphicon glyphicon-remove pull-right" aria-hidden="true"></span></a>')},eventAfterAllRender:function(m){jQuery(".btn-reservar").attr("href","/reserve");jQuery(".alert-overlap").hide();$.each($(".fc-event"),function(n,o){if($(o).data("duplicate")){$(".alert-overlap").show();$(".btn-reservar").removeAttr("href")}})}})}jQuery(document).on("click",".fc-event.cal-offer .move",function(o){o.preventDefault();var n=jQuery(this).data("oid");var m=jQuery(this).hasClass("prev")?"prev":jQuery(this).hasClass("next")?"next":"";$.ajax({type:"POST",url:"/calendar/process",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:n,dir:m},success:function(p){jQuery("#calendar").fullCalendar("refetchEvents")}})});jQuery(document).on("click",".fc-event.cal-offer .delete",function(n){n.preventDefault();var m=jQuery(this).data("oid");$("#delete-modal .btn-confirm").data("oid",m);$("#delete-modal").modal("show")});jQuery("#delete-modal .btn-confirm").on("click",function(n){n.preventDefault();var m=jQuery(this).data("oid");$("#delete-modal").modal("hide");$.ajax({type:"POST",url:"/offer/remove",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:m},success:function(){jQuery("#calendar").fullCalendar("refetchEvents");h();$(".offers-list li").each(function(o){if(o===m){$(this).remove()}});e()}})});function k(m){var n=$("#calendar").fullCalendar("clientEvents");for(i in n){if(n[i].id!=m.id){if(!(Date(n[i].start)>=Date(m.end)||Date(n[i].end)<=Date(m.start))){return true}}}return false}var b=$(".contact-form textarea[name='message']");var a=false;b.on("input",function(){if(b.val().length>2&&!a){$(".captcha-row").slideDown();a=true}});function j(m){return m.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}jQuery(".persona").on("change",function(){var o=$(this).parents(".offer-item").find(".price");var m=$(this).parents(".offer-item").find(".price sub").html();var n=0+o.data("unit-price");o.html("<sub>"+m+"</sub>"+j($(this).val()*n))});$("#image").change(function(){this.form.submit();$("#hiddenframe").on("load",function(){$.ajax({type:"GET",url:"/user/getAvatar",data:"",success:function(m){$("#youravatar").attr("src",m)}})})})});$(window).load(function(){if(window.location.pathname.indexOf("/guia/")===0){$(".opiniones").css("visibility","visible");$("#CDSWIDSSP .widSSPData .widSSPTrvlRtng .widSSPOverall div").each(function(){var a=$(this).html();$(this).html(a.replace("de viajeros",""))})}if(window.location.pathname.indexOf("/activity/")===0){$("#CDSWIDSSP .widSSPData .widSSPBranding dt a img, #CDSWIDSSP .widSSPData .widSSPBranding dt a:link img").attr("src","/images/logo-trip.png")}});