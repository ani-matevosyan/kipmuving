jQuery(document).ready(function(){jQuery(".raised-form").submit(function(g){g.preventDefault();window.location.href="/activities/"+jQuery("#activity_id_r").val()+"?dt="+jQuery("#activity_date_r").val();return false});jQuery(".btn-map").click(function(){jQuery("#map-modal").data("lat",jQuery(this).data("lat"));jQuery("#map-modal").data("lng",jQuery(this).data("lng"));jQuery("#map-modal").data("title",jQuery(this).data("title"));jQuery("#map-modal").modal("show")});jQuery("#map-modal").on("shown.bs.modal",function(){var l=jQuery(this).data("lat"),i=jQuery(this).data("lng");var m=jQuery(this).data("title");var j=new google.maps.LatLng(l,i);var h={zoom:15,center:j,mapTypeId:google.maps.MapTypeId.ROADMAP};var k=new google.maps.Map(document.getElementById("map-container"),h);var g=new google.maps.Marker({position:j,map:k,title:m})});function f(){$.ajax({type:"GET",url:"/activities/getsuprogram",data:"",success:function(g){$("#program_activities").text(g.data.offers);$("#program_persons").text(g.data.persons);$("#program_total").text(g.data.total)},error:function(){location.reload()}})}$(".overlay-opener").click(function(g){g.preventDefault()});$(".btn-reserve").click(function(){var i=$("#reserve-date").val();if(i==""){$("#message-modal #message").text("Seleccione primero la fecha.");$("#message-modal").modal("show");return false}var j=jQuery(this).data("offer-id");var h=$(this).parents(".offer-item").find(".persona").val();if(h==""){$("#message-modal #message").text("Seleccione primero la cantidad de personas de esta actividad.");$("#message-modal").modal("show");return false}var g=$(this).parents(".offer-item").find("select.hours").val();if(g==""){$("#message-modal #message").text("Seleccione primero la cantidad de horario de esta actividad.");$("#message-modal").modal("show");return false}$.ajax({type:"POST",url:"/offer/reserve",data:{_token:$('meta[name="csrf-token"]').attr("content"),offer_id:j,persons:h,date:i,timeRange:g},error:function(){location.reload()}}).done(function(){f();$.ajax({type:"GET",url:"/activities/getselectedoffers",data:"",success:function(l){var k=l.data[l.data.length-1];if($(".offers-list li").length===0){$("section.widget.summary").slideDown()}var m=moment(k.date,"DD/MM/YYYY").format("DD/MM");$(".offers-list").append("<li><a href='#'>"+m+" - "+k.name+"</a>");$("html, body").animate({scrollTop:"0px"},800)},error:function(){location.reload()}})});return false});jQuery(".btn-reserve-ag").click(function(){var i=jQuery(this).parents(".offer-item").find(".reserve-date").val();if(i==""){$("#message-modal #message").text("Please choose the date first.");$("#message-modal").modal("show");return false}var j=jQuery(this).data("offer-id");var h=$(this).parents(".offer-item").find(".persona").val();if(h==""){$("#message-modal #message").text("Choose persona first.");$("#message-modal").modal("show");return false}var g=$(this).parents(".offer-item").find("select.hours").val();if(g==""){$("#message-modal #message").text("Choose time.");$("#message-modal").modal("show");return false}$.ajax({type:"POST",url:"/offer/reserve",data:{_token:$('meta[name="csrf-token"]').attr("content"),offer_id:j,persons:h,date:i,timeRange:g},error:function(){location.reload()}});return false});function c(){var h=0;var g;$(".offers-list li").each(function(){var i=($(this).find("span").text());h+=parseInt(i.split(".").join(""))});$(".total .totalprice p").text(Number(h).toLocaleString("de-DE"));g=parseInt(h*0.1);$(".total .discount p").text(Number(g).toLocaleString("de-DE"))}jQuery(".offers-list").on("click","a",function(){var h=$(this).parent().prevAll().length;var g=$(this).parent();$.ajax({type:"POST",url:"/offer/remove",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:h},success:function(){g.remove();f();if($(".offers-list li").length===0){$("section.widget.summary").slideUp()}if(window.location.pathname==="/calendar"){c();jQuery("#calendar").fullCalendar("refetchEvents")}if(window.location.pathname==="/reserve"){location.reload()}},error:function(){location.reload()}});return false});var a;$(".delete_offer a").click(function(g){a=$(this).attr("href");g.preventDefault();$("#myModal").modal()});$("#confirm_cancel").click(function(g){g.preventDefault();window.location.href=a});var b=$(".contact-form textarea[name='message']");var e=false;b.on("input",function(){if(b.val().length>2&&!e){$(".captcha-row").slideDown();e=true}});function d(g){return g.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}jQuery(".persona").on("change",function(){var i=$(this).parents(".offer-item").find(".price");var g=$(this).parents(".offer-item").find(".price sub").html();var h=0+i.data("unit-price");i.html("<sub>"+g+"</sub>"+d(Math.round($(this).val()*h)))})});$(window).load(function(){if(window.location.pathname.indexOf("/guia/")===0){$(".opiniones").css("visibility","visible");$("#CDSWIDSSP .widSSPData .widSSPTrvlRtng .widSSPOverall div").each(function(){var a=$(this).html();$(this).html(a.replace("de viajeros",""))})}if(window.location.pathname.indexOf("/activity/")===0){$("#CDSWIDSSP .widSSPData .widSSPBranding dt a img, #CDSWIDSSP .widSSPData .widSSPBranding dt a:link img").attr("src","/images/logo-trip.png")}});