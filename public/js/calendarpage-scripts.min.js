$(document).ready(function(){function e(){$.ajax({type:"GET",url:"/activities/getsuprogram",data:"",success:function(e){$("#program_activities").text(e.data.offers),$("#program_activities").attr("data-activities",e.data.offers),$("#program_persons").text(e.data.persons),$("#program_total").text(e.data.total)},error:function(){location.reload()}})}function a(){var e,a=0;$(".offers-list li").each(function(){var e=$(this).find("span").text();a+=parseInt(e.split(".").join(""))}),$(".total .totalprice p").text(Number(a).toLocaleString("de-DE")),e=parseInt(.1*a),$(".total .discount p").text(Number(e).toLocaleString("de-DE"))}if($("#calendar").length){var t,n=$("#calendar").attr("data-date"),r=$("#calendar").attr("data-lang"),o=$(window).width();t=o>=992?5:o<991&&o>600?3:2,"es_ES"===r&&(r="es"),jQuery("#calendar").fullCalendar({lang:r,header:{left:"prev,next today",center:"title",right:""},defaultView:"agendaFourDay",views:{agendaFourDay:{type:"agenda",duration:{days:t},buttonText:"5 days",columnFormat:"ddd D/M"}},allDaySlot:!1,defaultDate:n,editable:!1,eventLimit:!0,events:"/calendar/data",eventOverlap:!0,eventRender:function(e,a){a.data("duplicate",e.duplicate),a.append("<br>"),a.append('<a href="#" class="move prev" data-oid="'+e.id+'"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></a>'),a.append('<a href="#" class="move next" data-oid="'+e.id+'"><span class="glyphicon glyphicon-chevron-right pull-right" aria-hidden="true"></span></a>'),a.append("<br>"),void 0!=e.agency_name?a.append('<div class="agency-name">'+e.agency_name+"</div>"):a.append("<br>"),a.append('<div class="hours"><i class="glyphicon glyphicon-time"></i> '+e.hours+" hrs ("+e.start_time+" a "+e.end_time+")</div>"),void 0!=e.persons&&a.append('<div class="persona"><i class="glyphicon glyphicon-user"></i> '+e.persons+" persona</div>"),a.append("<br>"),a.append('<a href="#" class="delete" data-oid="'+e.id+'"><span class="glyphicon glyphicon-remove pull-right" aria-hidden="true"></span></a>')},eventAfterAllRender:function(e){jQuery(".btn-reservar").attr("href","/reserve"),jQuery(".alert-overlap").hide(),$.each($(".fc-event"),function(e,a){$(a).data("duplicate")&&($(".alert-overlap").show(),$(".btn-reservar").removeAttr("href"))})}})}jQuery(document).on("click",".fc-event.cal-offer .move",function(e){e.preventDefault();var a=jQuery(this).data("oid"),t=jQuery(this).hasClass("prev")?"prev":jQuery(this).hasClass("next")?"next":"";$.ajax({type:"POST",url:"/calendar/process",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:a,dir:t},success:function(e){jQuery("#calendar").fullCalendar("refetchEvents")}})}),jQuery(document).on("click",".fc-event.cal-offer .delete",function(e){e.preventDefault();var a=jQuery(this).data("oid");$("#delete-modal .btn-confirm").data("oid",a),$("#delete-modal").modal("show")}),jQuery("#delete-modal .btn-confirm").on("click",function(t){t.preventDefault();var n=jQuery(this).data("oid");$("#delete-modal").modal("hide"),$.ajax({type:"POST",url:"/offer/remove",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:n},success:function(){jQuery("#calendar").fullCalendar("refetchEvents"),e(),$(".offers-list li").each(function(e){e===n&&$(this).remove()}),a()}})});var i=!1;$("#generate-link").click(function(e){e.preventDefault();var a=$(this).parent().find("input"),t=$(this);i?(a.select(),document.execCommand("copy")):$.ajax({type:"POST",url:"/proposals/save",data:{_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){a.val(e).slideDown(),i=!0,t.text("Copy")}})}),jQuery(".offers-list").on("click","a",function(){var t=$(this).parent().prevAll().length,n=$(this).parent();return $.ajax({type:"POST",url:"/offer/remove",data:{_token:$('meta[name="csrf-token"]').attr("content"),oid:t},success:function(){n.remove(),e(),0===$(".offers-list li").length&&$("section.widget.summary").slideUp(),"/calendar"===window.location.pathname&&(a(),jQuery("#calendar").fullCalendar("refetchEvents")),"/reserve"===window.location.pathname&&location.reload()},error:function(){location.reload()}}),!1});var l;$(".delete_offer a").click(function(e){l=$(this).attr("href"),e.preventDefault(),$("#myModal").modal()}),$("#confirm_cancel").click(function(e){e.preventDefault(),window.location.href=l})});